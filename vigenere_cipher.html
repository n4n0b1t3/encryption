<html>
<head>
	<meta charset="UTF-8"> 
	<title>Vigenère cipher</title>
<script>

function addListeners(){
	var button_encrypt = document.getElementById('button_encrypt');
	var button_decrypt = document.getElementById('button_decrypt');
	var output_text = document.getElementById('output_text');
	var output_keyword = document.getElementById('output_keyword');
	var alphabet = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
	
	if(window.addEventListener) {
		button_encrypt.addEventListener("click", encrypt, false);
		button_decrypt.addEventListener("click", decrypt, false);
	}
	
	function encrypt(){
		var keyword = document.getElementById('keyword').value;
		var message = document.getElementById('message').value;
		var alphabetlength=alphabet.length;
		var keyword_repeat = keyword.repeat(Math.floor(message.length/keyword.length)) + keyword.slice(0,message.length%keyword.length);
		var message_array = Array.from(message);

		output_keyword.value = keyword_repeat.toUpperCase();
		message_array.forEach(encrypt_letter);
		output_text.innerHTML = message_array.join("");

		function encrypt_letter(letter, index, calling_array){
			var letterposition = alphabet.indexOf(letter.toUpperCase());
			var key = keyword_repeat.charAt(index)
			var keyposition = alphabet.indexOf(key.toUpperCase())
			
			if(keyposition + letterposition < alphabet.length){
				console.log(letter + "(" + letterposition + ") with key " + key + "(" + keyposition + ") becomes " + alphabet.charAt(keyposition + letterposition));
				calling_array[index] = alphabet.charAt(keyposition + letterposition);
			}else{
				console.log(letter + "(" + letterposition + ") with key " + key + "(" + keyposition + ") becomes " + alphabet.charAt((keyposition + letterposition) - alphabet.length));
				calling_array[index] = alphabet.charAt((keyposition + letterposition) - alphabet.length);
			}
		}	
	}

	function decrypt(){
		var keyword = document.getElementById('keyword').value;
		var message = document.getElementById('message').value;
		var alphabetlength=alphabet.length;
		var keyword_repeat = keyword.repeat(Math.floor(message.length/keyword.length)) + keyword.slice(0,message.length%keyword.length);
		var message_array = Array.from(message);
		
		output_keyword.value = keyword_repeat.toUpperCase();
		message_array.forEach(decrypt_letter);
		output_text.innerHTML = message_array.join("");
		
		function decrypt_letter(letter, index, calling_array){
			// 1. take key accoring to index
			var key = keyword_repeat.charAt(index)
			
			// 2. get encrypted character position (message array [index])
			var letterposition = alphabet.indexOf(letter.toUpperCase());
			var keyposition = alphabet.indexOf(key.toUpperCase())
			
			if(keyposition >= letterposition){
				var alphabetposition = ((alphabet.length + (keyposition - letterposition)) % alphabet.length);
				console.log(">= " + letter + "(" + letterposition + ") with key " + key 
								  + "(" + keyposition + ") becomes " 
								  + alphabet.charAt(alphabetposition) + "(" + alphabetposition + ")");
				calling_array[index] = alphabet.charAt(alphabetposition);
			}else{
				var alphabetposition = letterposition - keyposition;
				console.log("else " + letter + "(" + letterposition + ") with key " + key + "(" + keyposition + ") becomes " + alphabet.charAt(alphabetposition) + "(" + alphabetposition + ")");
				calling_array[index] = alphabet.charAt(alphabetposition);
			}
		}
	}	
}


window.onload = addListeners;


</script>

<link rel="stylesheet" href="style.css">
</head>
<body>
<h1>Vigenère cipher</h1>
<div class="col-container">

<fieldset class="col">
	<legend>Input</legend>
	<section class="keyword">
		<label for="keyword">keyword</label>
		<input id="keyword" type="text" placeholder="password for de- / encryption" value="WURZEL"></br>
	</section>

	<section class="input">
		<label for="message">message</label>
		<textarea id="message" rows="10" cols="30">GUCSWNDUCD</textarea></br>
	</section>

	<section class="buttons">
		<button id="button_encrypt">encrypt</button>
		<button id="button_decrypt">decrypt</button>
	</section>	
</fieldset>

<fieldset class="col">
	<legend>Output</legend>

	<section>
		<label for="output_keyword">Keyword repeated at text length</label>
		<input id="output_keyword" type="text" placeholder="repeated keyword"></br>
	</section>
	<section>
		<label for="output_text">processed Message</label>
		<textarea id="output_text" rows="10" cols="30"></textarea></br>
	</section>
</fieldset>
</div>
</body>
</html>